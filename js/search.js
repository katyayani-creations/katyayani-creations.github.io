class GlobalSearch{constructor(){this.searchInput=document.getElementById("global-search"),this.suggestionsContainer=document.getElementById("search-suggestions"),this.searchBtn=document.querySelector(".search-btn"),this.debounceTimer=null,this.currentIndex=-1,this.suggestions=[],this.init()}init(){this.searchInput&&this.suggestionsContainer&&(this.searchInput.addEventListener("input",this.handleInput.bind(this)),this.searchInput.addEventListener("keydown",this.handleKeydown.bind(this)),this.searchInput.addEventListener("focus",this.handleFocus.bind(this)),this.searchInput.addEventListener("blur",this.handleBlur.bind(this)),this.searchBtn&&this.searchBtn.addEventListener("click",this.handleSearch.bind(this)),document.addEventListener("click",e=>{this.searchInput.contains(e.target)||this.suggestionsContainer.contains(e.target)||this.hideSuggestions()}))}handleInput(e){const t=e.target.value.trim();clearTimeout(this.debounceTimer),t.length<1?this.hideSuggestions():this.debounceTimer=setTimeout(()=>{this.fetchSuggestions(t)},300)}handleKeydown(e){const t=this.suggestionsContainer.querySelectorAll(".suggestion-item");switch(e.key){case"ArrowDown":e.preventDefault(),this.currentIndex=Math.min(this.currentIndex+1,t.length-1),this.updateSelection(t);break;case"ArrowUp":e.preventDefault(),this.currentIndex=Math.max(this.currentIndex-1,-1),this.updateSelection(t);break;case"Enter":e.preventDefault(),this.currentIndex>=0&&t[this.currentIndex]?this.selectSuggestion(this.suggestions[this.currentIndex]):this.handleSearch();break;case"Escape":this.hideSuggestions(),this.searchInput.blur()}}handleFocus(){const e=this.searchInput.value.trim();0===e.length?this.fetchSuggestions(""):e.length>=1&&this.fetchSuggestions(e)}handleBlur(){setTimeout(()=>{this.hideSuggestions()},200)}handleSearch(){const e=this.searchInput.value.trim();e&&(window.location.href=`products.php?search=${encodeURIComponent(e)}`)}fetchSuggestions(e){if("undefined"==typeof availableTags||!availableTags.length)return void this.hideSuggestions();if(""===e)return void this.hideSuggestions();const t=e.toLowerCase();this.suggestions=availableTags.filter(e=>e.label.toLowerCase().includes(t)||e.value.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)).sort((e,s)=>(e.value.toLowerCase().startsWith(t)?0:1)-(s.value.toLowerCase().startsWith(t)?0:1)).slice(0,10),this.suggestions.length>0?(this.renderSuggestions(),this.showSuggestions()):this.hideSuggestions()}renderSuggestions(){if(0===this.suggestions.length)return void(this.suggestionsContainer.innerHTML='\n                <div class="no-results">\n                    <span class="no-results-icon">ðŸ˜”</span>\n                    <span>No results found</span>\n                </div>\n            ');const e=this.suggestions.map((e,t)=>`\n                <div class="suggestion-item" data-index="${t}">\n                    <div class="suggestion-content">\n                        <div class="suggestion-text">\n                            <div class="suggestion-title">\n                                ${e.value}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `).join("");this.suggestionsContainer.innerHTML=e,this.suggestionsContainer.querySelectorAll(".suggestion-item").forEach((e,t)=>{e.addEventListener("click",()=>{this.selectSuggestion(this.suggestions[t])})})}updateSelection(e){e.forEach((e,t)=>{e.classList.toggle("selected",t===this.currentIndex)}),this.currentIndex>=0&&e[this.currentIndex]&&e[this.currentIndex].scrollIntoView({block:"nearest",behavior:"smooth"})}selectSuggestion(e){this.hideSuggestions(),this.searchInput.value=e.value,e.url&&(window.location.href=e.url)}showSuggestions(){this.suggestionsContainer.classList.remove("hidden"),this.currentIndex=-1}hideSuggestions(){this.suggestionsContainer.classList.add("hidden"),this.currentIndex=-1}}document.addEventListener("DOMContentLoaded",()=>{new GlobalSearch});