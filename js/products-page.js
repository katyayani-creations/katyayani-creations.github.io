class ProductsPage{constructor(){this.products=[],this.filteredProducts=[],this.currentPage=1,this.productsPerPage=12,this.isGridView=!0,this.filters={category:"",priceRange:"",sort:"name",search:""}}async init(){try{this.applyFilters()}catch(e){this.showError("Failed to load products. Please try again later.")}}async loadProducts(){this.loadProductsFromDOM()}loadProductsFromDOM(){const e=document.querySelectorAll(".product-card");this.products=Array.from(e).map(e=>({id:e.dataset.productId||"",name:e.querySelector("h3")?.textContent||"",category:e.dataset.category||"",price:e.querySelector(".price")?.textContent||""})),this.filteredProducts=[...this.products]}setupEventListeners(){const e=document.getElementById("name-search");e&&(e.addEventListener("input",e=>{this.filters.search=e.target.value.trim(),this.applyFilters()}),e.addEventListener("keyup",t=>{"Escape"===t.key&&(e.value="",this.filters.search="",this.applyFilters())})),document.getElementById("category-filter").addEventListener("change",e=>{this.filters.category=e.target.value,this.applyFilters()}),document.getElementById("price-filter").addEventListener("change",e=>{this.filters.priceRange=e.target.value,this.applyFilters()}),document.getElementById("sort-filter").addEventListener("change",e=>{this.filters.sort=e.target.value,this.applyFilters()}),document.getElementById("clear-filters").addEventListener("click",()=>{this.clearAllFilters()}),document.getElementById("grid-view").addEventListener("click",()=>{this.setGridView(!0)}),document.getElementById("list-view").addEventListener("click",()=>{this.setGridView(!1)});const t=document.getElementById("load-more");t&&t.addEventListener("click",()=>{this.loadMoreProducts()});const r=document.getElementById("global-search");r&&r.addEventListener("input",e=>{this.filters.search=e.target.value.trim(),this.applyFilters()})}setupURLParams(){const e=new URLSearchParams(window.location.search),t=e.get("search");if(t){this.filters.search=t;const e=document.getElementById("global-search");e&&(e.value=t)}const r=e.get("category");r&&(this.filters.category=r,document.getElementById("category-filter").value=r)}applyFilters(){if(this.filteredProducts=[...this.products],this.filters.category&&(this.filteredProducts=this.filteredProducts.filter(e=>e.category===this.filters.category)),this.filters.priceRange&&(this.filteredProducts=this.filteredProducts.filter(e=>{const t=this.extractPrice(e.price||e.mrp);return this.isPriceInRange(t,this.filters.priceRange)})),this.filters.search){const e=this.filters.search.toLowerCase();this.filteredProducts=this.filteredProducts.filter(t=>t.name.toLowerCase().includes(e)||t.description.toLowerCase().includes(e)||t.category&&t.category.toLowerCase().includes(e))}this.applySorting(),this.currentPage=1,this.renderProducts(),this.updateProductsCount()}applySorting(){switch(this.filters.sort){case"name":this.filteredProducts.sort((e,t)=>e.name.localeCompare(t.name));break;case"price-low":this.filteredProducts.sort((e,t)=>this.extractPrice(e.price||e.mrp)-this.extractPrice(t.price||t.mrp));break;case"price-high":this.filteredProducts.sort((e,t)=>{const r=this.extractPrice(e.price||e.mrp);return this.extractPrice(t.price||t.mrp)-r});break;case"featured":this.filteredProducts.sort((e,t)=>{const r=e.featured||"Featured"===e.badge||!1,c=t.featured||"Featured"===t.badge||!1;return r&&!c?-1:!r&&c?1:e.name.localeCompare(t.name)})}}extractPrice(e){return e&&parseFloat(e.replace(/[‚Çπ,]/g,""))||0}isPriceInRange(e,t){switch(t){case"0-50":return e>=0&&e<=50;case"50-100":return e>=50&&e<=100;case"100-200":return e>=100&&e<=200;case"200-500":return e>=200&&e<=500;case"500-1000":return e>=500&&e<=1e3;case"1000-2000":return e>=1e3&&e<=2e3;case"2000-5000":return e>=2e3&&e<=5e3;case"5000+":return e>=5e3;default:return!0}}renderProducts(){const e=document.getElementById("products-grid"),t=document.getElementById("load-more"),r=document.getElementById("no-products");if(0===this.filteredProducts.length)return e.innerHTML="",t.style.display="none",void(r.style.display="block");r.style.display="none";const c=this.filteredProducts.slice(0,this.currentPage*this.productsPerPage);e.innerHTML=c.map(e=>this.renderProductCard(e)).join("");const s=this.filteredProducts.length>c.length;t.style.display=s?"block":"none"}renderProductCard(e){const t=this.calculateDiscount(e),r=t>0?`<span class="discount">(${t}% OFF)</span>`:"",c=e.mrp&&e.mrp!==e.price?`<span class="mrp">${e.mrp}</span>`:"";return`\n            <div class="product-card ${e.featured?"featured-product":""}" data-product-id="${e.id}">\n                ${e.featured?'<div class="featured-badge">‚≠ê Featured</div>':""}\n                ${e.badge?`<div class="product-badge">${e.badge}</div>`:""}\n                \n                <div class="product-image">\n                    ${e.image?`<img src="${e.image}" alt="${e.name}" loading="lazy">`:'<div class="placeholder-emoji">üì¶</div>'}\n                </div>\n                \n                <div class="product-info">\n                    <h3>${e.name}</h3>\n                    <p>${e.description||""}</p>\n                    \n                    <div class="price-container">\n                        ${c}\n                        <span class="price">${e.price||e.mrp}</span>\n                        ${r}\n                    </div>\n                    \n                    ${void 0!==e.stock?`\n                        <div class="stock-info ${0===e.stock?"out-of-stock":""}">\n                            ${e.stock>0?`Stock: ${e.stock}`:"Out of Stock"}\n                        </div>\n                    `:""}\n                </div>\n            </div>\n        `}calculateDiscount(e){if(!e.mrp||!e.price||e.mrp===e.price)return 0;const t=this.extractPrice(e.mrp),r=this.extractPrice(e.price);return t>r&&t>0?Math.round((t-r)/t*100):0}loadMoreProducts(){this.currentPage++,this.renderProducts()}setGridView(e){this.isGridView=e;const t=document.getElementById("products-grid"),r=document.getElementById("grid-view"),c=document.getElementById("list-view");e?(t.classList.remove("list-view"),r.classList.add("active"),c.classList.remove("active")):(t.classList.add("list-view"),c.classList.add("active"),r.classList.remove("active"))}clearAllFilters(){this.filters={category:"",priceRange:"",sort:"name",search:""},document.getElementById("category-filter").value="",document.getElementById("price-filter").value="";const e=document.getElementById("name-search");e&&(e.value=""),document.getElementById("sort-filter").value="name";const t=document.getElementById("global-search");t&&(t.value="");const r=new URL(window.location);r.search="",window.history.replaceState({},"",r),this.applyFilters()}updateProductsCount(){const e=document.getElementById("products-count"),t=this.filteredProducts.length,r=Math.min(this.currentPage*this.productsPerPage,t);e.textContent=0===t?"No products found":r===t?`Showing all ${t} products`:`Showing ${r} of ${t} products`}showError(e){document.getElementById("products-grid").innerHTML=`\n            <div class="error-message" style="grid-column: 1 / -1; text-align: center; padding: 60px 20px;">\n                <div style="font-size: 3rem; margin-bottom: 20px;">üòî</div>\n                <h3 style="color: #e74c3c; margin-bottom: 10px;">Error Loading Products</h3>\n                <p style="color: #7f8c8d;">${e}</p>\n                <button onclick="location.reload()" class="cta-button" style="margin-top: 20px;">\n                    Try Again\n                </button>\n            </div>\n        `}}function clearAllFilters(){window.productsPage&&window.productsPage.clearAllFilters()}function handleFilterRedirect(e){const t=e.options[e.selectedIndex].getAttribute("data-url");t&&(window.location.href=t)}function filterByCategory(e){window.location.href=e?"products.php?catId="+e:"products.php"}function setupPriceFilter(){document.getElementById("price-filter")?.addEventListener("change",function(){const e=this.value;document.querySelectorAll(".product-card").forEach(t=>{const r=t.querySelector(".price");if(r){const c=parseFloat(r.textContent.replace(/[‚Çπ,]/g,""));let s=!0;("0-50"===e&&(c<0||c>50)||"50-100"===e&&(c<50||c>100)||"100-200"===e&&(c<100||c>200)||"200-500"===e&&(c<200||c>500)||"500-1000"===e&&(c<500||c>1e3)||"1000-2000"===e&&(c<1e3||c>2e3)||"2000-5000"===e&&(c<2e3||c>5e3)||"5000+"===e&&c<5e3)&&(s=!1),t.style.display=s?"":"none"}}),updateProductsCount()})}function sortProductCards(e){const t=document.getElementById("products-grid");if(!t)return;const r=Array.from(t.querySelectorAll(".product-card"));0!==r.length&&(r.sort((t,r)=>{switch(e){case"name":const e=t.querySelector("h3")?.textContent||"",c=r.querySelector("h3")?.textContent||"";return e.localeCompare(c);case"price-low":return parseFloat(t.querySelector(".price")?.textContent.replace(/[‚Çπ,]/g,"")||"0")-parseFloat(r.querySelector(".price")?.textContent.replace(/[‚Çπ,]/g,"")||"0");case"price-high":const s=parseFloat(t.querySelector(".price")?.textContent.replace(/[‚Çπ,]/g,"")||"0");return parseFloat(r.querySelector(".price")?.textContent.replace(/[‚Çπ,]/g,"")||"0")-s;default:return 0}}),r.forEach(e=>t.appendChild(e)))}function setupSortFilter(){document.getElementById("sort-filter")?.addEventListener("change",function(){sortProductCards(this.value)})}function setupClearFilters(){document.getElementById("clear-filters")?.addEventListener("click",function(){window.location.href="products.php"})}function updateProductsCount(){const e=document.querySelectorAll('.product-card:not([style*="display: none"])').length,t=document.getElementById("products-count");t&&(t.textContent=`Showing ${e} products`)}function setupViewToggle(){const e=document.getElementById("grid-view"),t=document.getElementById("list-view"),r=document.getElementById("products-grid");e?.addEventListener("click",function(){r.classList.remove("list-view"),this.classList.add("active"),t.classList.remove("active")}),t?.addEventListener("click",function(){r.classList.add("list-view"),this.classList.add("active"),e.classList.remove("active")})}function debugSort(){const e=document.getElementById("products-grid");(e?Array.from(e.querySelectorAll(".product-card")):[]).length}function filterProductsByName(e){const t=document.querySelectorAll(".product-card"),r=e.toLowerCase().trim();let c=0;t.forEach(e=>{const t=e.querySelector("h3")?.textContent.toLowerCase()||"",s=e.querySelector(".description")?.textContent.toLowerCase()||"";""===r||t.includes(r)||s.includes(r)?(e.style.display="block",e.classList.remove("hidden-search"),c++):(e.style.display="none",e.classList.add("hidden-search"))}),updateProductsCount(c);const s=document.getElementById("no-products");s&&(s.style.display=0===c?"block":"none")}function updateVisibleProductsCount(){const e=document.querySelectorAll(".product-card:not(.hidden-search)");updateProductsCount(e.length)}function updateProductsCount(e){const t=document.getElementById("products-count");t&&(t.textContent=`Showing ${e} products`)}document.addEventListener("DOMContentLoaded",function(){setupPriceFilter(),setupSortFilter(),setupClearFilters(),setupViewToggle(),updateProductsCount(),sortProductCards("price-high")}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("name-search");e&&(e.addEventListener("input",function(e){filterProductsByName(e.target.value)}),e.addEventListener("keyup",function(e){"Escape"===e.key&&(this.value="",filterProductsByName(""))}));const t=document.getElementById("clear-filters");t&&t.addEventListener("click",function(){e&&(e.value=""),filterProductsByName("");const t=document.getElementById("category-filter"),r=document.getElementById("price-filter"),c=document.getElementById("sort-filter");t&&(t.value=""),r&&(r.value=""),c&&(c.value="name")}),window.productsPage=new ProductsPage,window.productsPage.loadProductsFromDOM();const r=document.getElementById("clearAllFiltersBtn");r&&r.addEventListener("click",function(){clearAllFilters()}),updateProductsCount(document.querySelectorAll(".product-card").length)});