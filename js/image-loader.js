class ImageLoader{constructor(){this.retryAttempts=2,this.retryDelay=1e3,this.lazyObserver=null,this.initLazyLoading()}initLazyLoading(){if(!window.IntersectionObserver)return void this.loadAllImages();this.lazyObserver=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target;if("picture"===t.tagName.toLowerCase()){const e=t.querySelector("img"),a=t.getAttribute("data-original-src");e&&a&&(e.src=a,t.removeAttribute("data-original-src")),this.lazyObserver.unobserve(t)}else"img"===t.tagName.toLowerCase()&&(t.getAttribute("data-cdn-src")?this.loadImage(t):t.getAttribute("data-src")&&this.loadRegularImage(t),this.lazyObserver.unobserve(t))}})},{root:null,rootMargin:"50px 0px",threshold:.01})}loadImage(e){const t=e.getAttribute("data-cdn-src"),a=e.getAttribute("data-fallback-src")||e.src;t&&this.loadImageWithFallback(e,t,a,(t,a)=>{e.classList.add(a?"loaded-fallback":"loaded-cdn"),e.classList.remove("lazy-loading")},(t,a)=>{e.classList.add("load-failed"),e.classList.remove("lazy-loading")})}loadAllImages(){document.querySelectorAll("img[data-cdn-src]").forEach(e=>this.loadImage(e))}loadImageWithFallback(e,t,a,r=null,s=null){let o=0;const l=(i,n=!1)=>{e.onerror=null,e.onload=null,e.onload=()=>{r&&r(i,n),console.log(`Image loaded successfully: ${i}`)},e.onerror=()=>{if(o++,console.warn(`Failed to load image (attempt ${o}): ${i}`),!n&&a)console.log(`Trying fallback: ${a}`),setTimeout(()=>l(a,!0),this.retryDelay);else if(o<this.retryAttempts&&!n)setTimeout(()=>l(i,!1),this.retryDelay*o);else{console.error(`All attempts failed for image: ${t}`),s&&s(i,o),e.style.display="none";const a=e.parentNode;a&&a.querySelector(".placeholder-content")&&(a.querySelector(".placeholder-content").style.display="block")}},n?e.removeAttribute("crossorigin"):e.crossOrigin="anonymous",e.src=i};l(t)}initializeImages(){document.querySelectorAll("img").forEach(e=>{const t=e.getAttribute("loading"),a=e.getAttribute("data-cdn-src"),r=e.parentElement&&"picture"===e.parentElement.tagName.toLowerCase();if("eager"===t||"high"===e.getAttribute("fetchpriority"))a&&this.loadImage(e);else if("lazy"===t||!t)if(a)e.classList.add("lazy-loading"),this.lazyObserver?this.lazyObserver.observe(e):this.loadImage(e);else if(this.lazyObserver&&"lazy"===t){const t=e.src;if(r){const a=e.parentElement;a.hasAttribute("data-observed")||(a.setAttribute("data-observed","true"),a.setAttribute("data-original-src",t),e.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",this.lazyObserver.observe(a))}else e.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",e.setAttribute("data-src",t),this.lazyObserver.observe(e)}})}loadRegularImage(e){const t=e.getAttribute("data-src");t&&(e.src=t,e.removeAttribute("data-src"))}preloadImages(e){e.forEach(e=>{const t=new Image;this.loadImageWithFallback(t,e.cdn,e.fallback)})}}window.ImageLoader=new ImageLoader,document.addEventListener("DOMContentLoaded",function(){window.ImageLoader.initializeImages()});const observer=new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.forEach(function(e){if(1===e.nodeType){(e.querySelectorAll?e.querySelectorAll("img[data-cdn-src]"):[]).forEach(e=>{const t=e.getAttribute("data-cdn-src"),a=e.getAttribute("data-fallback-src")||e.src;t&&window.ImageLoader.loadImageWithFallback(e,t,a)})}})})});observer.observe(document.body,{childList:!0,subtree:!0});